<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>Dodge Hell</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
    }
    #gameCanvas {
        background: #222;
        display: block;
        margin: auto;
        margin-top: 20px;
        border: 2px solid white;
    }
    #scoreText {
        font-size: 24px;
        margin-top: 10px;
    }
</style>
</head>
<body>

<h1>Dodge Hell</h1>
<div id="scoreText">Score: 0</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = { x: 180, y: 550, w: 40, h: 40, speed: 5 };
let obstacles = [];
let gameOver = false;
let score = 0;
let speedUp = 1;

// 玩家控制（左＆右）
let leftPressed = false;
let rightPressed = false;
document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") leftPressed = true;
    if (e.key === "ArrowRight") rightPressed = true;
});
document.addEventListener("keyup", e => {
    if (e.key === "ArrowLeft") leftPressed = false;
    if (e.key === "ArrowRight") rightPressed = false;
});

// 手機版觸控
document.addEventListener("touchstart", e => {
    let x = e.touches[0].clientX;
    if (x < window.innerWidth / 2) leftPressed = true;
    else rightPressed = true;
});
document.addEventListener("touchend", e => {
    leftPressed = false;
    rightPressed = false;
});

// 障礙物生成
function spawnObstacle() {
    let size = Math.random() * 40 + 20;
    obstacles.push({
        x: Math.random() * (canvas.width - size),
        y: -size,
        w: size,
        h: size,
        speed: 3 + speedUp
    });
    setTimeout(spawnObstacle, Math.random() * 600 + 300); // 0.3~0.9秒生成一次
}
spawnObstacle();

// 判斷碰撞
function collide(a, b) {
    return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
    );
}

// 遊戲主循環
function gameLoop() {
    if (gameOver) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 玩家移動
    if (leftPressed) player.x -= player.speed;
    if (rightPressed) player.x += player.speed;
    player.x = Math.max(0, Math.min(canvas.width - player.w, player.x));

    // 畫玩家
    ctx.fillStyle = "cyan";
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // 畫障礙物
    ctx.fillStyle = "red";
    obstacles.forEach(o => {
        o.y += o.speed;
        ctx.fillRect(o.x, o.y, o.w, o.h);

        // 碰到玩家
        if (collide(player, o)) {
            gameOver = true;
            alert("Game Over! 你的分數: " + score);
            location.reload();
        }
    });

    // 清除離開畫面的障礙物
    obstacles = obstacles.filter(o => o.y < canvas.height);

    // 計分（每秒 +1）
    score += 0.02;
    document.getElementById("scoreText").textContent = "Score: " + Math.floor(score);

    // 隨時間加速
    speedUp += 0.0005;

    requestAnimationFrame(gameLoop);
}
gameLoop();
</script>

</body>
</html>
