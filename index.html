<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dodge Hell v2.1 - Custom Images</title>
    <style>
        body {
            margin: 0;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            background: #111;
            border: 3px solid #444;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="game" width="400" height="600"></canvas>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        // --- éŠæˆ²ç‹€æ…‹ç®¡ç† ---
        const STATE = { MENU: 0, PLAYING: 1, GAMEOVER: 2 };
        let currentState = STATE.MENU;
        let difficulty = 'easy'; 

        // --- ç©å®¶è¨­å®š ---
        const player = {
            x: 200, y: 500, size: 40, speed: 6,
            maxHp: 3, hp: 3,
            invincible: false, invincibleTime: 1000, lastHitTime: 0, blink: true
        };

        let left = false, right = false;
        let obstacles = [];
        let score = 0;
        let spawnTimer = null;

        // --- åœ–ç‰‡è¼‰å…¥å€ (é—œéµä¿®æ”¹) ---
        // å®šç¾©åœ–ç‰‡æª”æ¡ˆåç¨±
        const imageSources = ["obstacle1.png", "obstacle2.png", "obstacle3.png"];
        const loadedImages = [];

        // é å…ˆè¼‰å…¥æ‰€æœ‰åœ–ç‰‡
        imageSources.forEach(src => {
            const img = new Image();
            img.src = src;
            loadedImages.push(img);
        });

        // --- äº‹ä»¶ç›£è½ ---
        document.addEventListener("keydown", e => {
            if (e.key === "ArrowLeft") left = true;
            if (e.key === "ArrowRight") right = true;
            if (currentState === STATE.GAMEOVER && e.code === "Space") resetGameToMenu();
        });
        
        document.addEventListener("keyup", e => {
            if (e.key === "ArrowLeft") left = false;
            if (e.key === "ArrowRight") right = false;
        });

        canvas.addEventListener("mousedown", (e) => {
            if (currentState === STATE.MENU) {
                const rect = canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;

                if (clickX > 100 && clickX < 300) {
                    if (clickY > 250 && clickY < 310) startGame('easy');
                    if (clickY > 330 && clickY < 390) startGame('hard');
                }
            } else if (currentState === STATE.GAMEOVER) {
                resetGameToMenu();
            }
        });

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        function spawnObstacle() {
            if (currentState !== STATE.PLAYING) return;

            const w = 50, h = 50;
            const x = Math.random() * (canvas.width - w);
            
            // éš¨æ©Ÿé¸æ“‡ä¸€å¼µåœ–ç‰‡
            const randomImgIndex = Math.floor(Math.random() * loadedImages.length);
            const selectedImg = loadedImages[randomImgIndex];

            // å›°é›£æ¨¡å¼æ°´å¹³é€Ÿåº¦
            let vx = 0;
            if (difficulty === 'hard') {
                vx = (Math.random() - 0.5) * 6;
                if (Math.abs(vx) < 1) vx = 2; 
            }

            obstacles.push({
                x,
                y: -100,
                w,
                h,
                speed: 3 + Math.random() * 4 + (score * 0.01),
                vx: vx,
                img: selectedImg // å°‡åœ–ç‰‡å­˜å…¥è©²éšœç¤™ç‰©ç‰©ä»¶ä¸­
            });
        }

        function startGame(selectedDifficulty) {
            difficulty = selectedDifficulty;
            currentState = STATE.PLAYING;
            score = 0;
            obstacles = [];
            player.hp = player.maxHp;
            player.x = canvas.width / 2;
            player.invincible = false;
            
            let spawnRate = difficulty === 'hard' ? 700 : 900;
            if (spawnTimer) clearInterval(spawnTimer);
            spawnTimer = setInterval(spawnObstacle, spawnRate);
        }

        function resetGameToMenu() {
            currentState = STATE.MENU;
            if (spawnTimer) clearInterval(spawnTimer);
        }

        function drawMenu() {
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.font = "bold 50px Arial";
            ctx.fillText("DODGE HELL", canvas.width / 2, 150);
            
            ctx.font = "30px Arial";
            ctx.fillStyle = "#4CAF50"; 
            ctx.fillRect(100, 250, 200, 60);
            ctx.fillStyle = "white";
            ctx.fillText("ç°¡å–®æ¨¡å¼", canvas.width / 2, 290);

            ctx.fillStyle = "#F44336";
            ctx.fillRect(100, 330, 200, 60);
            ctx.fillStyle = "white";
            ctx.fillText("å›°é›£æ¨¡å¼", canvas.width / 2, 370);

            ctx.font = "16px Arial";
            ctx.fillStyle = "#aaa";
            ctx.fillText("è«‹é»æ“Šé¸é …é–‹å§‹", canvas.width / 2, 500);
        }

        function drawUI() {
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.textAlign = "left";
            ctx.fillText("Score: " + score, 20, 30);

            let hearts = "";
            for(let i=0; i<player.hp; i++) hearts += "â¤ï¸";
            ctx.textAlign = "right";
            ctx.fillText(hearts, canvas.width - 20, 30);
        }

        function update() {
            if (player.invincible) {
                if (Date.now() - player.lastHitTime > player.invincibleTime) {
                    player.invincible = false;
                    player.blink = true;
                } else {
                    player.blink = Math.floor(Date.now() / 100) % 2 === 0;
                }
            } else {
                player.blink = true;
            }

            if (left) player.x -= player.speed;
            if (right) player.x += player.speed;
            player.x = Math.max(20, Math.min(canvas.width - 20, player.x));

            obstacles.forEach(o => {
                o.y += o.speed;
                o.x += o.vx;

                if (difficulty === 'hard') {
                    if (o.x <= 0 || o.x + o.w >= canvas.width) o.vx *= -1;
                }

                // ç¢°æ’åˆ¤å®š
                if (!player.invincible &&
                    o.x < player.x + 15 && o.x + o.w > player.x - 15 &&
                    o.y < player.y + 15 && o.y + o.h > player.y - 15
                ) {
                    player.hp--;
                    player.invincible = true;
                    player.lastHitTime = Date.now();
                    if (player.hp <= 0) {
                        currentState = STATE.GAMEOVER;
                        if (spawnTimer) clearInterval(spawnTimer);
                    }
                }
            });

            obstacles = obstacles.filter(o => o.y < canvas.height + 100);
            if(currentState === STATE.PLAYING) score++;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (currentState === STATE.MENU) {
                drawMenu();
                requestAnimationFrame(draw);
                return;
            }

            if (player.blink) {
                ctx.font = player.size + "px Arial";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText("ğŸ‘¾", player.x, player.y);
            }

            // --- ç¹ªè£½éšœç¤™ç‰© (åœ–ç‰‡æ¨¡å¼) ---
            obstacles.forEach(o => {
                // å¦‚æœåœ–ç‰‡è¼‰å…¥å®Œæˆå‰‡é¡¯ç¤ºåœ–ç‰‡ï¼Œå¦å‰‡é¡¯ç¤ºå‚™ç”¨ Emoji
                if (o.img.complete) {
                    ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
                } else {
                    ctx.font = "40px Arial";
                    ctx.textAlign = "left";
                    ctx.fillText("â“", o.x, o.y + 40);
                }
            });

            drawUI();

            if (currentState === STATE.GAMEOVER) {
                ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = "red";
                ctx.font = "bold 50px Arial";
                ctx.textAlign = "center";
                ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2);
                
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.fillText("Score: " + score, canvas.width / 2, canvas.height / 2 + 50);
                
                ctx.font = "20px Arial";
                ctx.fillStyle = "#aaa";
                ctx.fillText("é»æ“Šç•«é¢æˆ–æŒ‰ç©ºç™½éµè¿”å›é¸å–®", canvas.width / 2, canvas.height / 2 + 100);
            } else {
                update();
            }

            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
